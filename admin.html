<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin | Tango's</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --black: #000;
      --white: #fff;
      --yellow: #FFB308;
      --dark-yellow: #e09900;
      --gray: #111;
    }
    * { margin:0; 
       padding:0; 
       box-sizing:border-box; }
    body {
      background: var(--black);
      color: var(--white);
      font-family: 'Inter', sans-serif;
      text-align: center;
      min-height: 100vh;
      background-image: linear-gradient(45deg, #000000, #222222);
    }
    
    .container {
      max-width:100%; 
      padding:2rem 1rem; 
      margin:0 auto }
    
    .logo-container { 
      margin-bottom:2rem 
    }
    
    .logo {
      width:120px; 
      display:block; 
      margin:0 auto;
      filter:drop-shadow(0 0 10px rgba(255,179,8,0.5));
      animation:pulse 2s infinite;
      cursor:pointer;
    }
    @keyframes pulse {
      0%,100% {transform:scale(1)} 
      50% {transform:scale(1.05)}
    }
    h1 {
      font-size:2rem; font-weight:900; color:var(--yellow);
      margin-bottom:2rem; text-transform:uppercase;
      letter-spacing:2px; text-shadow:0 0 15px rgba(255,179,8,0.7);
    }
    input, textarea, select, button {
      width:90%; max-width:350px; padding:1rem;
      margin-bottom:1.5rem; font-size:1rem;
      border:none; border-radius:12px; transition:all .3s ease;
    }
    input, textarea, select {
      background:#222; color:var(--white);
      border:2px solid var(--yellow);
    }
    input:focus, textarea:focus, select:focus {
      outline:none; box-shadow:0 0 15px rgba(255,179,8,0.5);
      transform:translateY(-2px);
    }
    button {
      background:var(--yellow); color:var(--black);
      font-weight:900; text-transform:uppercase;
      letter-spacing:1px; box-shadow:0 5px 15px rgba(0,0,0,0.3);
      position:relative; overflow:hidden; cursor:pointer;
    }
    button:hover {
      background:var(--dark-yellow); transform:translateY(-3px);
      box-shadow:0 7px 20px rgba(0,0,0,0.4);
    }
    button:active { transform:translateY(0); }
    button::after {
      content:''; position:absolute; top:0; left:-100%;
      width:100%; height:100%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition:.5s;
    }
    button:hover::after { left:100%; }
    .btn-group {
      display:flex; flex-direction:column; gap:1.5rem; margin:3rem 0;
    }
    .btn-group button {
      max-width:300px; margin:0 auto; height:60px;
      display:flex; align-items:center; justify-content:center;
    }
    .icon { margin-right:10px; font-size:1.5rem; }
    .section {
      display:none; background:rgba(17,17,17,0.8);
      padding:2rem 1rem; margin-top:2rem; border-radius:16px;
      border:2px solid var(--yellow);
      box-shadow:0 0 20px rgba(255,179,8,0.3);
      backdrop-filter:blur(10px);
    }
    .section.active {
      display:block; animation:fadeIn .5s ease;
    }
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(20px) }
      to { opacity:1; transform:translateY(0) }
    }
    .producto-item {
      background:#222; margin:.8rem auto; padding:1rem;
      border-radius:12px; max-width:90%; cursor:pointer;
      transition:all .3s; border-left:4px solid var(--yellow);
      text-align:left;
    }
    .producto-item:hover {
      background:#333; transform:translateX(5px);
      box-shadow:0 5px 15px rgba(0,0,0,0.2);
    }
    .status {
      font-weight:bold; color:var(--yellow);
      margin-top:1rem; padding:.5rem; border-radius:8px;
      background:rgba(255,179,8,0.1);
    }
    #auth {
      max-width:400px; margin:4rem auto; padding:2rem;
      background:rgba(17,17,17,0.8); border-radius:16px;
      border:2px solid var(--yellow);
      box-shadow:0 0 30px rgba(255,179,8,0.3);
    }
    .salir-btn {
      background:#333; color:var(--white);
      border:2px solid var(--yellow);
      margin-top:3rem; padding:1rem 2rem;
      border-radius:12px; font-size:1rem;
      transition:background .3s;
    }
    .salir-btn:hover { background:#444; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-container">
      <img src="assets/images/logo3.png"
           alt="Logo Tango's"
           class="logo"
           onclick="window.location.href='index.html'" />
    </div>

    <!-- üîê Autenticaci√≥n -->
    <div id="auth">
      <h1>Administrador</h1>
      <input type="password" id="clave"
             placeholder="Contrase√±a de acceso"
             autocomplete="off"
             inputmode="numeric" />
      <button id="btnAcceder">Entrar</button>
      <p id="statusGlobal" class="status"></p>
    </div>

    <!-- Panel -->
    <div id="panel" style="display:none;">
      <h1>Gesti√≥n de productos</h1>
      <div class="btn-group">
        <button onclick="mostrar('a√±adir')">
          <span class="icon">‚ûï</span> A√±adir producto
        </button>
        <button onclick="mostrar('eliminar')">
          <span class="icon">üóëÔ∏è</span> Eliminar producto
        </button>
      </div>
      <p id="statusGlobal2" class="status"></p>

      <!-- A√±adir producto -->
      <div id="a√±adir" class="section">
        <form id="formNuevo">
          <input type="text" id="nombre"
                 placeholder="Nombre" required />
          <textarea id="descripcion"
                    placeholder="Descripci√≥n" required>
          </textarea>
          <input type="number" id="precio"
                 placeholder="Precio" required />
          <!-- NUEVO: selector de categor√≠a -->
          <select id="categoria" required>
            <option value="" disabled selected>
              Selecciona categor√≠a
            </option>
            <option value="bebidas">ü•§ Bebidas</option>
            <option value="snacks">üçü Snacks</option>
            <option value="elotes">üåΩ Elotes</option>
            <option value="delicias">üçì Delicias</option>
          </select>
          <input type="file" id="imagen"
                 accept="image/*" required />
          <button type="submit">Guardar producto</button>
          <p id="status" class="status"></p>
        </form>
      </div>

      <!-- Eliminar producto -->
      <div id="eliminar" class="section">
        <div id="listaEliminar"></div>
      </div>

      <!-- Salir -->
      <button onclick="salirAdmin()" class="salir-btn">
        <span class="icon">üö™</span> Salir del modo admin
      </button>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'
    const supabase = createClient(
      'https://ljlaudvreolkdppgfqul.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...tu_anon_key_aqu√≠'
    );

    const statusGlobal = document.getElementById("statusGlobal");
    const statusGlobal2 = document.getElementById("statusGlobal2");

    document.getElementById('btnAcceder')
      .addEventListener('click', () => {
      const clave = document.getElementById("clave").value;
      if (clave === "240624") {
        document.getElementById("auth").style.display = "none";
        document.getElementById("panel").style.display = "block";
        cargarProductos();
      } else {
        statusGlobal.textContent = "‚ùå Contrase√±a incorrecta";
      }
    });

    function mostrar(id) {
      document.querySelectorAll(".section")
        .forEach(div => div.classList.remove("active"));
      document.getElementById(id)
        .classList.add("active");
      statusGlobal2.textContent = "";
    }
    window.mostrar = mostrar;

    window.salirAdmin = () => {
      window.location.href = "index.html";
    }

    /* ‚Äî A√±adir producto ‚Äî */
    document.getElementById("formNuevo")
      .addEventListener("submit", async e => {
      e.preventDefault();

      const nombre      = document.getElementById("nombre").value;
      const descripcion = document.getElementById("descripcion").value;
      const precio      = parseFloat(
        document.getElementById("precio").value
      );
      const categoria   = document.getElementById("categoria").value;
      const archivo     = document.getElementById("imagen").files[0];

      if (!categoria) {
        return document.getElementById("status")
                 .textContent = "‚ùå Selecciona una categor√≠a.";
      }

      const nombreArchivo = `${Date.now()}-${archivo.name}`;
      const { error: errUpload } = await supabase
        .storage
        .from('productos')
        .upload(nombreArchivo, archivo);
      if (errUpload) {
        console.error("UPLOAD ERROR:", errUpload);
        return document.getElementById("status")
                 .textContent = `‚ùå Upload: ${errUpload.message}`;
      }

      const { data: urlData } = supabase
        .storage
        .from('productos')
        .getPublicUrl(nombreArchivo);
      const imagen_url = urlData.publicUrl;

      const { error: errInsert } = await supabase
        .from("productos")
        .insert([{
          nombre,
          descripcion,
          precio,
          categoria,
          imagen_url
        }]);
      if (errInsert) {
        console.error("INSERT ERROR:", errInsert);
        return document.getElementById("status")
                 .textContent = `‚ùå Insert: ${errInsert.message}`;
      }

      document.getElementById("status")
        .textContent = "‚úÖ Producto guardado";
      e.target.reset();
      cargarProductos();
    });

    /* ‚Äî Eliminar producto ‚Äî */
    async function cargarProductos() {
      const { data: productos } = await supabase
        .from("productos").select("*")
        .order("created_at",{ascending:false});
      const listaEliminar = document.getElementById("listaEliminar");
      listaEliminar.innerHTML = "";
      productos.forEach(p => {
        const del = document.createElement("div");
        del.className = "producto-item";
        del.textContent = `[${p.categoria}]  ${p.nombre}`;
        del.onclick = async () => {
          if (confirm(`¬øEliminar "${p.nombre}"?`)) {
            await supabase.from("productos")
              .delete().eq("id",p.id);
            statusGlobal2.textContent = "‚úÖ Producto eliminado";
            cargarProductos();
          }
        };
        listaEliminar.appendChild(del);
      });
    }
  </script>
</body>
</html>
