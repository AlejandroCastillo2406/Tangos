<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin | Tango's</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --black: #000;
      --white: #fff;
      --yellow: #ffd700;
      --gray: #111;
    }

    body {
      background: var(--black);
      color: var(--white);
      font-family: 'Inter', sans-serif;
      padding: 2rem 1rem;
      text-align: center;
    }

    .logo {
      width: 100px;
      margin: 0 auto 1rem;
      display: block;
    }

    h1 {
      font-size: 2rem;
      font-weight: 900;
      color: var(--yellow);
      margin-bottom: 2rem;
    }

    input, textarea, select, button {
      width: 90%;
      max-width: 350px;
      padding: 0.75rem;
      margin-bottom: 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
    }

    input, textarea, select {
      background: #222;
      color: var(--white);
    }

    select option {
      background: #111;
      color: #fff;
    }

    button {
      background: var(--yellow);
      color: var(--black);
      font-weight: 900;
      cursor: pointer;
    }

    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin: 2rem 0;
    }

    .btn-group button {
      max-width: 300px;
      margin: 0 auto;
    }

    .section {
      display: none;
      background: var(--gray);
      padding: 2rem 1rem;
      margin-top: 2rem;
      border-radius: 12px;
    }

    .section.active {
      display: block;
    }

    .producto-item {
      background: #222;
      margin: 0.5rem auto;
      padding: 1rem;
      border-radius: 8px;
      max-width: 90%;
      cursor: pointer;
      transition: background 0.3s;
    }

    .producto-item:hover {
      background: #333;
    }

    .status {
      font-weight: bold;
      color: var(--yellow);
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

  <img src="assets/images/logo1.png" alt="Logo Tango's" class="logo" />

  <div id="auth">
    <h1>Administrador</h1>
    <input type="password" id="clave" placeholder="Contrase√±a de acceso" autocomplete="off" inputmode="numeric" />
    <button id="btnAcceder">Entrar</button>
  </div>

  <div id="panel" style="display:none;">
    <h1>Gesti√≥n de productos</h1>

    <div class="btn-group">
      <button onclick="mostrar('a√±adir')">‚ûï A√±adir producto</button>
      <button onclick="mostrar('actualizar')">‚úèÔ∏è Actualizar producto</button>
      <button onclick="mostrar('eliminar')">üóëÔ∏è Eliminar producto</button>
    </div>

    <p id="statusGlobal" class="status"></p>

    <div id="a√±adir" class="section">
      <form id="formNuevo">
        <input type="text" id="nombre" placeholder="Nombre" required />
        <textarea id="descripcion" placeholder="Descripci√≥n" required></textarea>
        <input type="number" id="precio" placeholder="Precio" required />
        <select id="categoria" required>
          <option value="" disabled selected>Selecciona una categor√≠a</option>
          <option value="bebidas">ü•§ Bebidas</option>
          <option value="snacks">üçü Snacks</option>
          <option value="elotes">üåΩ Elotes</option>
          <option value="delicias">üçì Delicias</option>
        </select>
        <input type="file" id="imagen" accept="image/*" required />
        <button type="submit">Guardar producto</button>
        <p id="status" class="status"></p>
      </form>
    </div>

    <div id="actualizar" class="section"><div id="listaActualizar"></div></div>
    <div id="eliminar" class="section"><div id="listaEliminar"></div></div>

    <button onclick="salirAdmin()" style="margin-top: 3rem;">üö™ Salir del modo admin</button>
  </div>
    <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabase = createClient(
      'https://ljlaudvreolkdppgfqul.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqbGF1ZHZyZW9sa2RwcGdmcXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzEzOTYsImV4cCI6MjA2MDYwNzM5Nn0.tv5PybOJ0ZUtA2aw2WzPqQ9M7SZm3uke6Ad-OuxZbzk'
    );

    const statusGlobal = document.getElementById("statusGlobal");

    document.getElementById('btnAcceder').addEventListener('click', () => {
      const clave = document.getElementById("clave").value;
      if (clave === "240624") {
        document.getElementById("auth").style.display = "none";
        document.getElementById("panel").style.display = "block";
        cargarProductos();
      } else {
        statusGlobal.textContent = "‚ùå Contrase√±a incorrecta";
      }
    });

    function mostrar(id) {
      document.querySelectorAll(".section").forEach(div => div.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      statusGlobal.textContent = "";
    }
    window.mostrar = mostrar;

    window.salirAdmin = () => {
      document.getElementById("panel").style.display = "none";
      document.getElementById("auth").style.display = "block";
      document.getElementById("clave").value = "";
      statusGlobal.textContent = "";
    }

    document.getElementById("formNuevo").addEventListener("submit", async (e) => {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value;
      const descripcion = document.getElementById("descripcion").value;
      const precio = parseFloat(document.getElementById("precio").value);
      const categoria = document.getElementById("categoria").value;
      const archivo = document.getElementById("imagen").files[0];

      if (!categoria) {
        document.getElementById("status").textContent = "‚ùå Selecciona una categor√≠a.";
        return;
      }

      const nombreArchivo = `${Date.now()}-${archivo.name}`;
      const { error: errorUpload } = await supabase.storage.from('productos').upload(nombreArchivo, archivo);

      if (errorUpload) {
        document.getElementById("status").textContent = "‚ùå Error al subir imagen";
        return;
      }

      const { data } = supabase.storage.from('productos').getPublicUrl(nombreArchivo);
      const imagen_url = data.publicUrl;

      const { error: errorInsert } = await supabase.from("productos").insert([
        { nombre, descripcion, precio, imagen_url, categoria }
      ]);

      if (errorInsert) {
        document.getElementById("status").textContent = "‚ùå Error al guardar producto";
        return;
      }

      document.getElementById("status").textContent = "‚úÖ Producto guardado";
      e.target.reset();
      cargarProductos();
    });

    async function cargarProductos() {
      const { data: productos } = await supabase.from("productos").select("*").order("created_at", { ascending: false });
      const listaActualizar = document.getElementById("listaActualizar");
      const listaEliminar = document.getElementById("listaEliminar");
      listaActualizar.innerHTML = "";
      listaEliminar.innerHTML = "";

      productos.forEach(p => {
        const del = document.createElement("div");
        del.className = "producto-item";
        del.textContent = p.nombre;
        del.onclick = async () => {
          if (confirm(`¬øEliminar "${p.nombre}"?`)) {
            await supabase.from("productos").delete().eq("id", p.id);
            statusGlobal.textContent = "‚úÖ Producto eliminado";
            cargarProductos();
          }
        };
        listaEliminar.appendChild(del);

        const upd = document.createElement("div");
        upd.className = "producto-item";
        upd.textContent = p.nombre;
        upd.onclick = async () => {
          const nuevo = prompt("Editar nombre|precio|descripcion", `${p.nombre}|${p.precio}|${p.descripcion}`);
          if (nuevo) {
            const [nombre, precio, descripcion] = nuevo.split("|");
            const archivoInput = document.createElement("input");
            archivoInput.type = "file";
            archivoInput.accept = "image/*";
            archivoInput.onchange = async () => {
              let nuevaUrl = p.imagen_url;
              if (archivoInput.files.length > 0) {
                const archivo = archivoInput.files[0];
                const nuevoNombre = `${Date.now()}-${archivo.name}`;
                await supabase.storage.from('productos').upload(nuevoNombre, archivo);
                const { data } = supabase.storage.from('productos').getPublicUrl(nuevoNombre);
                nuevaUrl = data.publicUrl;
              }

              await supabase.from("productos").update({
                nombre,
                precio,
                descripcion,
                imagen_url: nuevaUrl
              }).eq("id", p.id);

              statusGlobal.textContent = "‚úÖ Producto actualizado";
              cargarProductos();
            };
            archivoInput.click();
          }
        };
        listaActualizar.appendChild(upd);
      });
    }
  </script>
</body>
</html>

