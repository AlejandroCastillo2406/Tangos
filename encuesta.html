<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Encuesta - Tango's</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Aquí van los estilos previos de tu código */
    body {
      background: var(--black);
      color: var(--white);
      font-family: 'Inter', sans-serif;
      padding: 2rem;
      text-align: center;
    }

    .encuesta-wrapper {
      max-width: 600px;
      margin: 0 auto;
      background-color: #222;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .encuesta-formulario {
      margin-bottom: 2rem;
    }

    label {
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }

    .btn-guardar {
      background-color: var(--yellow);
      color: var(--black);
      padding: 0.75rem 2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      border: none;
    }

    .btn-guardar:hover {
      background-color: var(--dark-yellow);
    }

    .mensaje-confirmacion {
      font-weight: bold;
      color: var(--yellow);
      margin-top: 1rem;
    }
  </style>
</head>
<body>

  <div class="encuesta-wrapper">
    <h2>Tu opinión nos importa</h2>
    <form id="formEncuesta">
      <!-- Sección 1: Sabor -->
      <div id="seccion-sabor" class="encuesta-formulario">
        <h3>¿Qué te pareció el sabor?</h3>
        <label><input type="radio" name="sabor" value="5"> Excelente</label><br>
        <label><input type="radio" name="sabor" value="4"> Muy bueno</label><br>
        <label><input type="radio" name="sabor" value="3"> Bueno</label><br>
        <label><input type="radio" name="sabor" value="2"> Regular</label><br>
        <label><input type="radio" name="sabor" value="1"> Malo</label><br>
      </div>

      <!-- Sección 2: Local -->
      <div id="seccion-local" class="encuesta-formulario" style="display:none;">
        <h3>¿Qué opinas del local?</h3>
        <label><input type="radio" name="local" value="5"> Excelente</label><br>
        <label><input type="radio" name="local" value="4"> Muy bueno</label><br>
        <label><input type="radio" name="local" value="3"> Bueno</label><br>
        <label><input type="radio" name="local" value="2"> Regular</label><br>
        <label><input type="radio" name="local" value="1"> Malo</label><br>
      </div>

      <!-- Sección 3: Atención -->
      <div id="seccion-atencion" class="encuesta-formulario" style="display:none;">
        <h3>¿Cómo fue la atención?</h3>
        <label><input type="radio" name="atencion" value="5"> Excelente</label><br>
        <label><input type="radio" name="atencion" value="4"> Muy buena</label><br>
        <label><input type="radio" name="atencion" value="3"> Buena</label><br>
        <label><input type="radio" name="atencion" value="2"> Regular</label><br>
        <label><input type="radio" name="atencion" value="1"> Mala</label><br>
      </div>

      <!-- Sección 4: Comentarios -->
      <div id="seccion-comentarios" class="encuesta-formulario" style="display:none;">
        <h3>Observaciones (opcional)</h3>
        <textarea id="comentarios" rows="4" placeholder="¿Algo que quieras comentarnos?"></textarea><br>
      </div>

      <button type="button" id="btnSiguiente" class="btn-guardar">Siguiente</button>
    </form>

    <p id="mensajeConfirmacion" class="mensaje-confirmacion"></p>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js';

    const supabase = createClient(
      'https://ljlaudvreolkdppgfqul.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqbGF1ZHZyZW9sa2RwcGdmcXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzEzOTYsImV4cCI6MjA2MDYwNzM5Nn0.tv5PybOJ0ZUtA2aw2WzPqQ9M7SZm3uke6Ad-OuxZbzk'
    );

    const btnSiguiente = document.getElementById('btnSiguiente');
    const mensajeConfirmacion = document.getElementById("mensajeConfirmacion");
    let currentSection = 1;

    function mostrarSiguiente() {
      const sabor = document.querySelector('input[name="sabor"]:checked')?.value;
      const local = document.querySelector('input[name="local"]:checked')?.value;
      const atencion = document.querySelector('input[name="atencion"]:checked')?.value;

      // Validar que cada sección esté respondida
      if (currentSection === 1 && !sabor) {
        mensajeConfirmacion.textContent = "❌ Por favor selecciona una opción para el sabor.";
        return;
      }

      if (currentSection === 2 && !local) {
        mensajeConfirmacion.textContent = "❌ Por favor selecciona una opción para el local.";
        return;
      }

      if (currentSection === 3 && !atencion) {
        mensajeConfirmacion.textContent = "❌ Por favor selecciona una opción para la atención.";
        return;
      }

      // Mostrar la siguiente sección
      if (currentSection === 1) {
        document.getElementById("seccion-sabor").style.display = "none";
        document.getElementById("seccion-local").style.display = "block";
        currentSection = 2;
      } else if (currentSection === 2) {
        document.getElementById("seccion-local").style.display = "none";
        document.getElementById("seccion-atencion").style.display = "block";
        currentSection = 3;
      } else if (currentSection === 3) {
        document.getElementById("seccion-atencion").style.display = "none";
        document.getElementById("seccion-comentarios").style.display = "block";
        currentSection = 4;
        btnSiguiente.textContent = "Enviar Encuesta"; // Cambiar texto del botón
      } else if (currentSection === 4) {
        const comentarios = document.getElementById("comentarios").value;

        // Guardar encuesta en Supabase
        const { data, error } = await supabase.from("encuestas").insert([
          {
            sabor_1: sabor,
            local_1: local,
            atencion_1: atencion,
            comentarios: comentarios || null
          }
        ]);

        if (error) {
          mensajeConfirmacion.textContent = "❌ Ocurrió un error al enviar la encuesta.";
        } else {
          mensajeConfirmacion.textContent = "✅ Encuesta enviada con éxito!";
        }
      }
    }

    btnSiguiente.addEventListener('click', mostrarSiguiente);
  </script>

</body>
</html>

