<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Encuesta - Tango's</title>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Aquí están los estilos mejorados */
    body {
      background-color: #0e0e0e;
      color: #fff;
      font-family: 'Inter', sans-serif;
      padding: 2rem;
      text-align: center;
    }

    .encuesta-wrapper {
      max-width: 600px;
      margin: 0 auto;
      background-color: #1e1e1e;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    h2 {
      color: #ffb308;
      font-size: 2rem;
      margin-bottom: 2rem;
    }

    .encuesta-formulario {
      margin-bottom: 2rem;
    }

    .btn-guardar {
      background-color: #ffb308;
      color: black;
      padding: 0.75rem 2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      border: none;
    }

    .btn-guardar:hover {
      background-color: #e09900;
    }

    .pregunta-container {
      margin-bottom: 2rem;
    }

    .opcion {
      display: inline-block;
      padding: 10px 20px;
      background-color: #333;
      border-radius: 50px;
      color: #fff;
      font-size: 1.1rem;
      margin: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .opcion:hover {
      background-color: #444;
    }

    .opcion:active {
      background-color: #555;
    }

    .mensaje-confirmacion {
      font-weight: bold;
      color: #ffb308;
      margin-top: 1rem;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #444;
      border-radius: 5px;
      margin-bottom: 2rem;
    }

    .progress-bar span {
      display: block;
      height: 100%;
      background-color: #ffb308;
      width: 0%;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <div class="encuesta-wrapper">
    <h2>Tu opinión nos importa</h2>
    <form id="formEncuesta">
      <!-- Barra de progreso -->
      <div class="progress-bar">
        <span id="progress-bar" style="width: 0%"></span>
      </div>

      <!-- Sección de preguntas -->
      <div id="seccion-sabor" class="encuesta-formulario">
        <h3>¿Qué te pareció el sabor?</h3>
        <div class="pregunta-container">
          <span class="opcion" onclick="guardarRespuesta('sabor', 5)">Excelente</span>
          <span class="opcion" onclick="guardarRespuesta('sabor', 4)">Muy Bueno</span>
          <span class="opcion" onclick="guardarRespuesta('sabor', 3)">Bueno</span>
          <span class="opcion" onclick="guardarRespuesta('sabor', 2)">Regular</span>
          <span class="opcion" onclick="guardarRespuesta('sabor', 1)">Malo</span>
        </div>
      </div>

      <div id="seccion-local" class="encuesta-formulario" style="display:none;">
        <h3>¿Qué opinas del local?</h3>
        <div class="pregunta-container">
          <span class="opcion" onclick="guardarRespuesta('local', 5)">Excelente</span>
          <span class="opcion" onclick="guardarRespuesta('local', 4)">Muy Bueno</span>
          <span class="opcion" onclick="guardarRespuesta('local', 3)">Bueno</span>
          <span class="opcion" onclick="guardarRespuesta('local', 2)">Regular</span>
          <span class="opcion" onclick="guardarRespuesta('local', 1)">Malo</span>
        </div>
      </div>

      <div id="seccion-atencion" class="encuesta-formulario" style="display:none;">
        <h3>¿Cómo fue la atención?</h3>
        <div class="pregunta-container">
          <span class="opcion" onclick="guardarRespuesta('atencion', 5)">Excelente</span>
          <span class="opcion" onclick="guardarRespuesta('atencion', 4)">Muy Bueno</span>
          <span class="opcion" onclick="guardarRespuesta('atencion', 3)">Bueno</span>
          <span class="opcion" onclick="guardarRespuesta('atencion', 2)">Regular</span>
          <span class="opcion" onclick="guardarRespuesta('atencion', 1)">Malo</span>
        </div>
      </div>

      <div id="seccion-comentarios" class="encuesta-formulario" style="display:none;">
        <h3>Observaciones (opcional)</h3>
        <textarea id="comentarios" rows="4" placeholder="¿Algo que quieras comentarnos?"></textarea><br>
      </div>

      <button type="button" id="btnSiguiente" class="btn-guardar">Siguiente</button>
    </form>

    <p id="mensajeConfirmacion" class="mensaje-confirmacion"></p>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js';

    const supabase = createClient(
      'https://ljlaudvreolkdppgfqul.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxqbGF1ZHZyZW9sa2RwcGdmcXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzEzOTYsImV4cCI6MjA2MDYwNzM5Nn0.tv5PybOJ0ZUtA2aw2WzPqQ9M7SZm3uke6Ad-OuxZbzk'
    );

    let currentSection = 1;
    let respuestas = {};

    // Función para guardar respuesta
    function guardarRespuesta(seccion, respuesta) {
      respuestas[seccion] = respuesta;
      mostrarSiguiente();
    }

    // Función para mostrar la siguiente sección
    function mostrarSiguiente() {
      if (currentSection === 1 && !respuestas['sabor']) {
        return alert("Por favor selecciona una opción para el sabor.");
      }

      if (currentSection === 2 && !respuestas['local']) {
        return alert("Por favor selecciona una opción para el local.");
      }

      if (currentSection === 3 && !respuestas['atencion']) {
        return alert("Por favor selecciona una opción para la atención.");
      }

      if (currentSection === 4) {
        const comentarios = document.getElementById('comentarios').value;
        respuestas['comentarios'] = comentarios;

        // Enviar encuesta a Supabase
        supabase.from('encuestas').insert([respuestas]).then(response => {
          if (response.error) {
            document.getElementById('mensajeConfirmacion').textContent = "❌ Error al enviar la encuesta";
          } else {
            document.getElementById('mensajeConfirmacion').textContent = "✅ Encuesta enviada con éxito!";
          }
        });

        // Mostrar mensaje de éxito
        return;
      }

      document.getElementById(`seccion-${['sabor', 'local', 'atencion'][currentSection - 1]}`).style.display = 'none';
      currentSection++;
      document.getElementById(`seccion-${['sabor', 'local', 'atencion'][currentSection - 1]}`).style.display = 'block';

      // Actualizar progreso
      document.getElementById('progress-bar').style.width = (currentSection * 33.3) + '%';
      if (currentSection === 4) {
        document.getElementById('btnSiguiente').textContent = 'Enviar Encuesta';
      }
    }

    document.getElementById('btnSiguiente').addEventListener('click', mostrarSiguiente);
  </script>

</body>
</html>
